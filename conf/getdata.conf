#
AnonymousFtpPassword  positionz@linz.govt.nz
#
ScratchDir            /tmp
#
#  Base filename for station prediction models
#

RefStationFilename  ${D}/LINZ/ref_stations/[ssss].xml 
RefStationCacheDir  ${D}/LINZ/ref_stations/.cache

# Ranking factors for selecting reference stations.
#
# Exclude stations within 5 metres to avoid using a PostioNZ staion for data
# from that station (not realistic except for testing/academic purposes)

RankDistanceFactor <<EOD
        4.99         0
           5       100
       30000        95
      200000        87
      500000        70
     5000000         0
EOD

RankCosineFactor     10

# Notes on gnss data abbreviation formats:
# (Codes can be lower case or upper case, corresponding case will apply to 
# substituted string)
#
# Abbreviation     Description
# ssss             4 character station code (lower case)
# yy               Year (two digits)
# ddd              Day of Year (DOY)
# dddh             DOY + hourly session character indicating
#                  the hourly session A - X (00-23)
# yyyy             Year (four digits)
# wwww             GPS Week
# ww               2-digit week of year(00-51)
# wwww             GPS Week
# d                Day of week (0 = Sunday)
# hh               The UTC hour for which the orbit product was created
# h                Hour as a letter a-x
#
# jobid            The id of the current job
# type             The data type
# subtype          The data subtype
#
#
# DataTypes: These are the naming convensions used in the local repository.
# Any data downloaded from a data center that does not conform to these specs
# will be converted. The defined data format are also the defaults used for
# each data center. These format follow the above stated gnss abbreviations.
#
# Refer to annotated example below for datacenter tag structure:
#
#<DataTypes>
#    // First level is data type
#    <OBS>
#        // Second level is data subtype
#        <DAILY>
#            filename [ssss][ddd][h].[yy]d.Z
#            // Defines the file name format for the datatype
#            path [yyyy]/[ddd]/
#            // Defines the path to the data file from the base path of the data center
#            compression ..
#            // The compression of the data type
#            // Valid values are
#            // none
#            // compress
#            // gzip
#            // hatanaka
#            // hatanaka+compress
#            // hatanaka+gzip
#            freq Hourly
#            // Defines the frequency of in which files occur. The option
#            // Hourly, 6Hourly, Daily, Weekly.
#            supply_frequency
#            // Defines the frequency with which files are supplied.
#            latency ...
#            // Defines the time after the end of the interval when the data is expected
#            // to be available.  The time is formatted as one of
#            // ### minutes
#            // ## hours
#            // ## days 
#            retry 1 day
#            // The frequency that the data will be retried if it is not 
#            // available
#            max_delay 30 days
#            // The period after the nominal available data when the data
#            // will be deemed unavailable
#            retention 2 days
#            // The minimum time after downloading for which data will be retained
#            priorty #
#            // The integer priority of the subtype - the lower the value the higher 
#            // the priority.  
#        </DAILY>
#        <HOURLY>
#            ...
#        </HOURLY>
#    </OBS>
#    // 'CUMULATIVE' only
#    <SSC>
#       <CUMULATIVE>
#           ...
#       </CUMULATIVE>
#    </FINAL>
#    // 'FINAL', 'RAPID', 'ULTRA' or 'BROADCAST'
#    <ORB>
#        <FINAL>
#            ...
#        </FINAL>
#        <RAPID>
#            ...
#        </RAPID>
#    </ORB>
#    // 'FINAL', 'RAPID' or 'ULTRA'
#    <ERP>
#        <ULTRA>
#            ...
#        </ULTRA>
#    </ERP>
#</DataTypes>
#

# Each compression type is define by
#   a name used to define it in data types
#   a command to run it using [input] and [output] for the input and output file names
#   a presuffix that is added to the filename before the command is run
#   a postsuffix that is removed from the filename after the command is run
#
# Decompression is defined by using "-typename" as the name
#
<CompressionTypes>
   <Compression>
       name hatanaka
       compress /usr/bin/rnx2crx -f [input] 
       uncompress /usr/bin/crx2rnx -f [input]
       presuffix .ddo
       postsuffix .ddd
   </Compression>
   <Compression>
       name compress
       compress /usr/bin/compress -f [input] 
       uncompress /usr/bin/compress -f -d [input] 
       presuffix 
       postsuffix .Z
   </Compression>
   <Compression>
       name gzip
       compress /bin/gzip -f -9 [input] 
       uncompress /bin/gzip -f -d [input] 
       presuffix 
       postsuffix .gz
   </Compression>
</CompressionTypes>

<DataTypes>
    <OBS>
        <DAILY>
            name Daily RINEX files
            priority 2
            filename [ssss][ddd]0.[yy]d.Z
            compression hatanaka+compress
            path  rinex/daily/[yyyy]/[ddd]
        </DAILY>
        <HOURLY>
            name Hourly RINEX files
            priority 1
            filename [ssss][ddd][h].[yy]d.Z
            compression hatanaka+compress
            frequency Hourly
            path  rinex/hourly/[yyyy]/[ddd]/[hh]
            retention 2 days
        </HOURLY>
    </OBS>
    <SSC>
        <CUMULATIVE>
            filename igs[yy]p[ww].ssc.Z
            compression compress
            frequency Weekly
            path  ssc/[wwww]
        </CUMULATIVE>
    </SSC>
    <ORB>
        <BROADCAST>
            name Broadcast orbits
            filename auto[ddd]0.[yy]n.Z
            compression compress
            path  orbit/broadcast/[yyyy]/[ddd]
        </BROADCAST>
        <FINAL>
            name Final orbits
            priority 4
            filename igs[wwww][d].sp3.Z
            compression compress
            path  orbit/final/[wwww]
        </FINAL>
        <RAPID>
            name Rapid orbits
            priority 3
            filename igr[wwww][d].sp3.Z
            compression compress
            path  orbit/rapid/[wwww]
            retention 30 days
        </RAPID>
        <ULTRA>
            name Ultra-rapid orbits
            priority 2
            filename igu[wwww][d]_[hh].sp3.Z
            compression compress
            path  orbit/ultra/[wwww]
            frequency 6Hourly
            retention 7 days
        </ULTRA>
    </ORB>
    <ERP>
        <FINAL>
            name Final earth rotation parameters
            priority 4
            filename igs[wwww]7.erp.Z
            compression compress
            frequency Weekly
            path  erp/final/[wwww]
        </FINAL>
        <RAPID>
            name Rapid earth rotation parameters
            priority 3
            filename igr[wwww][d].erp.Z
            compression compress
            path  erp/rapid/[wwww]
            retention 30 days
        </RAPID>
        <ULTRA>
            name Ultra-rapid earth rotation parameters
            priority 2
            filename igu[wwww][d]_[hh].erp.Z
            compression compress
            frequency 6Hourly
            path  erp/ultra/[wwww]
            retention 7 days
        </ULTRA>
    </ERP>
    <ION>
       <FINAL>
           name  Bernese CODE Ionosphere models
           priority 4
           filename COD[wwww][d].ION.Z
           compression compress
           path code/ion/[yyyy]/[ddd]
       </FINAL>
    </ION>

#  This is only available for EUREF solution
#    <INX>
#       <FINAL>
#           name  Bernese Ionosphere maps
#           priority 4
#           filename COD[wwww][d].INX.Z
#           compression compress
#           path /code/inx/[yyyy]/[ddd]
#       </FINAL>
#    </INX>
    <TRP>
       <FINAL>
           name  Bernese Troposphere parameters
           priority 4
           filename COD[yy][ddd].TRP.Z
           compression compress
           path /code/trp/[yyyy]/[ddd]
       </FINAL>
    </TRP>
    <P1C1>
        <FINAL>
           name CODE monthly P1-C1 DCB solutions (GPS satellites only)
           priority 4
           filename P1C1[yy][mm].DCB.Z
           compression compress
           path /code/p1c1/[yyyy]
        </FINAL>
    </P1C1>
    <P1P2>
        <FINAL>
           name CODE monthly P1-P2 DCB solutions (GPS and Glonass satellites)
           priority 4
           filename P1P2[yy][mm].DCB.Z
           compression compress
           path /code/p1p2/[yyyy]
        </FINAL>
    </P1P2>
    <VMF>
       <VMF>
           name  Vienna atmospheric mapping functions
           priority 4
           filename VMFG_[yyyy][mm][dd].H[hh]
           compression none
           frequency 6Hourly
           path /vmf/[yyyy]/[ddd]
       </VMF>
    </VMF>
</DataTypes>


#
# Stations: A list of Default stations to obtain from the data centers. This
# list will control which stations to get, but also helps the script to
# # indentify when further searches in data centers are not required.
# #
# <Stations>
#     # These are PositioNZ stations
#     Code auck corm dnvk gisb hamt hast hikb maho mast nply taup trng wang wgtn
#     Code whng bluf chat dund gldb haas hoki kaik lexa lkta mavl mqzg mtjo nlsn
#     Code sctb waim west
#     # These are ARGN/Pacific/Antarctic IGS stations
#     Code mac1 mcm4 mobs pert yarr yar2 nnor karr darr darw jab1 tow2 sunm
#     Code cedu alic sydn str1 str2 tid2 tid1 tidb coco lae1 noum fale aspa
#     Code cas1 dav1 davr mkea rob4
# </Stations>
# #
# #
# #
# # 
# #
# #
# #
# # RemoveRedundant: If set this will remove all datafiles that are no longer
# # needed because more complete or more precise datafiles have been downloaded
# #
# RemoveRedundant On
# #
# # DataCheck: If set this will perform simple data quality checks on the
# # observational data and produce a qc xml file. This is useful for making
# # decisions on the appropreiteness of the data for certain processing.
# #
# DataCheck On
# #
# # CompressFile: If set then all files added to the product manager are UNIX
# #               compressed (and CRX compressed if RINEX OBS)
# #
# CompressFiles On
# #
# # ReEntry: The number of retries that will be attempted on a datacenter ftp
# # connection or login before aborting the connection.
# #
# ReEntry 1
# #
# # Delay: Time delay in sec used for ftp connect and login retries
# #
# Delay 10
# #
# # ScheduledDownloads: A list of times for scheduled downloads of products. List
# # items should be of "time days" format, where time locatime in HH::MM::SS
# # format and days are number of days to mirror products for.
# # Note: Multiple tasks can not be scheduled at the same time. Also scheduled
# # tasks that are initiated while another task is running are not run.
# # 
# <ScheduledDownloads>
#     00:30:00 30
#     08:00:00 02
#     12:00:00 02
#     18:00:00 02
# </ScheduledDownloads>
# #
# # DownloadTimeout: If there is no activity for a speficied time during a
# # scheduled download, then the download will be cancelled. Default is 600 secs.
# #
# DownloadTimeout 600
# #
# # DataCenter: This defines the repository information such as the name, uri,
# # and data files that are required from each. Each datafile must have a
# # definition in the DataTypes tag. The datafile tag can override the format
# # tag, and should include a path element on where to find the data relative to
# # the base uri.
# #
# # Refer to annotated example below for datacenter tag structure:
# 
# # DataCenter tag attribute is the datacenter id used for choosing the order in
# # which centers will be downloaded from
# #<DataCenter 1>
# #    // Provides a name for the center. Used for naming in logging
# #    Name EXAMPLE
# #    // Defines ftp host and optionaly user/pass and port for server
# #    Uri ftp://user@domain.com@exampleserver.com:21
# #    <Datafiles>
# #    // Observable datatypes that datacenter supports. Use the same structure
# #    // as the datatypes tag
# #    <OBS>
# #        <DAILY>
# #            // Path on server to the datatype files
# #            path /pub/rinex/obs/[yyyy]/[ddd]
# #           // Specifies the daily obs file station codes which the server can
# #           // provide. Note that multiple tag keys can be listed for ease of
# #           // formating
# #           stations tst1 tst2 tst3
# #           stations tst4 tst5 tst6
# #        </DAILY>
# #        <HOURLY>
# #            path /pub/hourly/rinex/[yyyy]/[ddd]
# #            // Specifies the hourly obs file station codes which the server can
# #            // provide. In some case sites might only provide daily files to
# #            // the datacenter so this just provides a short circuit in checking
# #            // for the files. If this tag key is not specified then it is
# #            // assumed that that the all of the daily obs files also have
# #            // hourly files.
# #            stations tst1 tst2 tst3
# #            stations tst4 tst5
# #        </HOURLY>
# #    </OBS>
# #    // Product datatypes that datacenter supports. Use the same structure
# #    // as the datatypes tag
# #    <SSC>
# #        <CUMULATIVE>
# #            path /pub/gps/products/[wwww]
# #        </CUMULATIVE>
# #    </SSC>
# #    <ORB>
# #        <FINAL>
# #            path /pub/products/[wwww]
# #        </FINAL>
# #    </ORB>
# #    <ORB>
# #        <RAPID>
# #            path /pub/products/[wwww]
# #        </RAPID>
# #    </ORB>
# #    <ERP>
# #        <ULTRA>
# #            path /pub/products/[wwww]
# #        </ULTRA>
# #    </ERP>
# #    </Datafiles>
# #</DataCenter>
# #
# 
<DataCenters>
    <DataCenter>
        priority 4
        Name GeoNET
        Uri ftp://anonymous:positionz@linz.govt.nz@ftp.geonet.org.nz
        Stations auck corm dnvk gisb hamt hast hikb maho mast nply taup
        Stations wang wgtn whng bluf chat dund gldb haas hoki kaik lexa
        Stations mavl mqzg mtjo nlsn sctb waim west trng lkta
        Stations chti ktia meth ousd pygr vgmt wark wgtt whkt
        Stations *
        <Datafiles>
            <OBS>
                <DAILY>
                    path /gps/rinex/[yyyy]/[ddd]
                </DAILY>
                <HOURLY>
                    path /gps/nrtdata/[yyyy]/[ddd]/[hh]
                    latency 15 minutes
                </HOURLY>
            </OBS>
        </Datafiles>
    </DataCenter>
    
    <DataCenter>
        priority 3
        Name UNAVCO
        Uri ftp://anonymous:positionz@linz.govt.nz@data-out.unavco.org
        Stations rob4
        <Datafiles>
            <OBS>
                <DAILY>
                    path /pub/rinex/obs/[yyyy]/[ddd]
                </DAILY>
                <HOURLY>
                    path /pub/hourly/rinex/[yyyy]/[ddd]/[ssss]
                    latency 15 minutes
                </HOURLY>
            </OBS>
        </Datafiles>
    </DataCenter>
    
    <DataCenter>
        priority 2
        Name SOPAC
        Uri ftp://anonymous:positionz@linz.govt.nz@garner.ucsd.edu
        Stations mac1 mcm4 mobs pert yarr yar2 yarr nnor karr darr darw
        Stations sunm cedu alic sydn str1 str2 tid2 tid1 tidb coco lae1
        Stations fale aspa cas1 dav1 davr mkea tow2 jab1 noum
        Stations *
        <Datafiles>
            <OBS>
                <DAILY>
                    path /pub/rinex/[yyyy]/[ddd]
                </DAILY>
                <HOURLY>
                    path /pub/nrtdata/[yyyy]/[ddd]/[hh]
                    latency 15 minutes
                </HOURLY>
            </OBS>
            <SSC>
                <CUMULATIVE>
                    path /pub/products/[wwww]
                </CUMULATIVE>
            </SSC>
            <ORB>
                <FINAL>
                    path /pub/products/[wwww]
                    supply_frequency weekly
                    latency 12 days
                </FINAL>
                <RAPID>
                    path /pub/products/[wwww]
                    latency 17 hours
                </RAPID>
                <ULTRA>
                    path /pub/products/[wwww]
                    latency 3 hours
                </ULTRA>
            </ORB>
            <ERP>
                <FINAL>
                    path /pub/products/[wwww]
                    latency 12 days
                </FINAL>
                <RAPID>
                    path /pub/products/[wwww]
                    latency 17 hours
                </RAPID>
                <ULTRA>
                    path /pub/products/[wwww]
                    latency 3 hours
                </ULTRA>
            </ERP>
        </Datafiles>
    </DataCenter>
    
    <DataCenter>
        priority 1
        Name CDDIS
        Uri ftp://anonymous:positionz@linz.govt.nz@cddis.gsfc.nasa.gov
        Stations mac1 mcm4 mobs pert yarr yar2 yarr nnor karr darr darw
        Stations sunm cedu alic sydn str1 str2 tid2 tid1 tidb coco lae1
        Stations fale aspa cas1 dav1 davr mkea tow2 jab1 noum
        Stations *
        <Datafiles>
            <OBS>
                <DAILY>
                    path /gps/data/daily/[yyyy]/[ddd]/[yy]d
                </DAILY>
                <HOURLY>
                    path /gps/data/hourly/[yyyy]/[ddd]/[hh]
                </HOURLY>
            </OBS>
            <SSC>
                <CUMULATIVE>
                    path /pub/gps/products/[wwww]
                </CUMULATIVE>
            </SSC>
            <ORB>
                <FINAL>
                    path /pub/gps/products/[wwww]
                    supply_frequency weekly
                    latency 12 days
                </FINAL>
                <RAPID>
                    latency 17 hours
                    path /pub/gps/products/[wwww]
                </RAPID>
                <ULTRA>
                    latency 3 hours
                    path /pub/gps/products/[wwww]
                </ULTRA>
            </ORB>
            <ERP>
                <FINAL>
                    path /pub/gps/products/[wwww]
                    latency 12 days 
                </FINAL>
                <RAPID>
                    latency 17 hours
                    path /pub/gps/products/[wwww]
                </RAPID>
                <ULTRA>
                    latency 3 hours
                    path /pub/gps/products/[wwww]
                </ULTRA>
            </ERP>
        </Datafiles>
    </DataCenter>

    <DataCenter>
        priority 1
        name CODE
        Uri ftp://anonymous:positionz@linz.govt.nz@ftp.unibe.ch/aiub
        <Datafiles>
#        <INX>
#           <FINAL>
#               latency 2 days
#               path /CODE/[yyyy]
#           </FINAL>
#        </INX>
        <TRP>
           <FINAL>
               latency 2 days
               path /BSWUSER52/ATM/[yyyy]
           </FINAL>
        </TRP>
        <ION>
           <FINAL>
               latency 2 days
               path /CODE/[yyyy]
           </FINAL>
        </ION>
        <P1C1>
           <FINAL>
               latency 35 days
               path /CODE/[yyyy]
           </FINAL>
        </P1C1>
        <P1P2>
           <FINAL>
               latency 35 days
               path /CODE/[yyyy]
           </FINAL>
        </P1P2>
        </Datafiles>
    </DataCenter>

    <DataCenter>
        priority 1
        name GGOS
        Uri http://ggosatm.hg.tuwien.ac.at
        <DataFiles>
        <VMF>
           <VMF>
               latency 2 days
               path /DELAY/GRID/VMFG/[yyyy]
           </VMF>
        </VMF>
        </DataFiles>
    </DataCenter>

    <DataCenter>
        priority 0
        Name Cache
        Stations *
	Uri  file://${D}
    </DataCenter>

    <DataCenter>
        priority 0
        name bernese
        Stations *
        Uri file://${P}
        <DataFiles>
            <OBS>
                <DAILY>
                    priority 2
                    filename [SSSS][DDD]0.[YY]O
                    compression none
                    path  [JOB]/RAW
                </DAILY>
                <HOURLY>
                    priority 1
                    filename [SSSS][DDD][H].[YY]O
                    compression none
                    path  [JOB]/RAW
                </HOURLY>
            </OBS>
            <ORB>
                <BROADCAST>
                    filename AUTO[ddd]0.[yy]N
                    compression none
                    path  [JOB]/ORB
                </BROADCAST>
                <FINAL>
                    priority 4
                    filename IGS[WWWW][D].PRE
                    compression none
                    path  [JOB]/ORB
                </FINAL>
                <RAPID>
                    priority 3
                    filename IGR[WWWW][D].PRE
                    compression none
                    path  [JOB]/ORB
                </RAPID>
                <ULTRA>
                    priority 2
                    filename IGU[WWWW][D][HH].PRE
                    compression none
                    path  [JOB]/ORB
                </ULTRA>
            </ORB>
            <ERP>
                <FINAL>
                    priority 4
                    filename IGS[WWWW]7.IEP
                    compression none
                    path  [JOB]/ORB
                </FINAL>
                <RAPID>
                    priority 3
                    filename IGR[WWWW][D].IEP
                    compression none
                    path  [JOB]/ORB
                </RAPID>
                <ULTRA>
                    priority 2
                    filename IGU[WWWW][D][HH].IEP
                    compression none
                    path  [JOB]/ORB
                </ULTRA>
            </ERP>
            <ION>
                <FINAL>
                    filename COD[wwww][d].ION
                    compression none
                    path [JOB]/ATM
                </FINAL>
            </ION>
#            <INX>
#                <FINAL>
#                    filename COD[wwww][d].INX
#                    compression none
#                    path [JOB]/ATM
#                </FINAL>
#            </INX>
            <TRP>
                <FINAL>
                    filename COD[wwww][d].TRP
                    compression none
                    path [JOB]/ATM
                </FINAL>
            </TRP>
            <P1C1>
               <FINAL>
                   latency 35 days
                   path [JOB]/ORB
                   filename P1C1[yy][mm].DCB
                   compression none
               </FINAL>
            </P1C1>
            <P1P2>
               <FINAL>
                   latency 35 days
                   path [JOB]/ORB
                   filename P1P2[yy][mm].DCB
                   compression none
               </FINAL>
            </P1P2>

            <VMF>
                <VMF>
                    filename VMF[WWWW][D][HH].GRD
                    compression none
                    path [JOB]/GRD
                </VMF>
            </VMF>
        </DataFiles>
    </DataCenter>
</DataCenters>

<Cache>
    datacenter cache
    # Number of days a job will be retained by default before being purged
    job_retention 28
    # Queued data latency in seconds. 
    # Time allowed for a queued request to be processed, added
    # to the data available time to suggest the next time for checking for the data
    queue_latency 1800
</Cache>

# #
# # LogSettings: The logging for the Product Manager. These must follow log4perl
# # config rules.
# #

LogDir /var/log/bernese52/getdata
LogFile getdata-${year}-${month}.log
LogFileRetention 365

LogSettings <<EOF
 log4perl.logger                                    = INFO,Logfile
# ##############################################################################
# # Config for the STDOUT Appender
# ##############################################################################
# log4perl.appender.Screen                           = Log::Log4perl::Appender::Screen
# log4perl.appender.Screen.layout                    = Log::Log4perl::Layout::PatternLayout
# log4perl.appender.Screen.stderr                    = 0
# log4perl.appender.Screen.layout.ConversionPattern  = %d %p> %F{1}:%L - %m%n
# ##############################################################################
# # Config for the Log file Appender (will rotate the file once it is bigger
# # than 5 Mb )
# ##############################################################################
log4perl.appender.Logfile                          = Log::Log4perl::Appender::File
log4perl.appender.Logfile.filename                 = [logfilename]
log4perl.appender.Logfile.mode                     = append
log4perl.appender.Logfile.umask                    = 0002
log4perl.appender.Logfile.layout                   = Log::Log4perl::Layout::PatternLayout
log4perl.appender.Logfile.layout.ConversionPattern = %d %p> %F{1}:%L - %m%n
log4perl.appender.Logfile.TZ                       = NZDT
EOF
